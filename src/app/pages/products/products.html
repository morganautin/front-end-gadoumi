<!-- ðŸ” BARRE DE FILTRES -->
<div class="filters-bar" [formGroup]="filters">
  <mat-form-field appearance="outline">
    <mat-label>Note minimale</mat-label>
    <mat-select formControlName="minRating" (selectionChange)="onFiltersChange()">
      <mat-option [value]="null">Toutes</mat-option>
      <mat-option [value]="3">3+</mat-option>
      <mat-option [value]="4">4+</mat-option>
      <mat-option [value]="5">5</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Trier par</mat-label>
    <mat-select formControlName="ordering" (selectionChange)="onFiltersChange()">
      <mat-option [value]="null">Par dÃ©faut</mat-option>
      <mat-option value="price">Prix croissant</mat-option>
      <mat-option value="-price">Prix dÃ©croissant</mat-option>
      <mat-option value="-rating">Meilleures notes</mat-option>
    </mat-select>
  </mat-form-field>
</div>

<!-- â³ LOADING -->
<p *ngIf="loading$ | async">Chargement des produitsâ€¦</p>

<!-- ðŸ“¦ LISTE DES PRODUITS -->
<div class="products-grid" *ngIf="!(loading$ | async)">

  <mat-card *ngFor="let p of (products$ | async)" class="product-card">
    <mat-card-title class="product-title">{{ p.name }}</mat-card-title>

    <mat-card-content class="product-content">
      <div>Prix : {{ p.price | currency : 'EUR' }}</div>
      <div>Date : {{ p.created_at | date }}</div>

      <div>
        Moyenne :
        <ng-container *ngIf="ratings[p.id]?.avg as avg; else noRating">
          {{ avg | number : '1.1-2' }}/5
          <span *ngIf="ratings[p.id]?.count as c"> ({{ c }} avis)</span>
        </ng-container>
        <ng-template #noRating>â€”</ng-template>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <!-- â¤ï¸ FAVORIS -->
      <button
        mat-icon-button
        (click)="toggleFavorite(p)"
        [attr.aria-label]="isFavorite(p.id) ? 'Retirer des favoris' : 'Ajouter aux favoris'">
        <mat-icon [color]="isFavorite(p.id) ? 'warn' : undefined">
          {{ isFavorite(p.id) ? 'favorite' : 'favorite_border' }}
        </mat-icon>
      </button>

      <!-- ðŸ›’ PANIER -->
      <button mat-raised-button color="accent" (click)="addToCart(p)">
        ðŸ›’ Ajouter au panier
      </button>
    </mat-card-actions>
  </mat-card>

  <!-- EMPTY STATE -->
  <p *ngIf="(products$ | async)?.length === 0">
    Aucun produit ne correspond Ã  vos filtres
  </p>
</div>

<!-- ðŸ“„ PAGINATION -->
<div class="pagination" *ngIf="(count$ | async) as total">
  <button
    mat-button
    (click)="previousPage()"
    [disabled]="filters.value.page === 1">
    â—€ PrÃ©cÃ©dent
  </button>

  <span>
    Page {{ filters.value.page }} /
    {{ getTotalPages(total) }}
  </span>

  <button
    mat-button
    (click)="nextPage(total)"
    [disabled]="filters.value.page! >= getTotalPages(total)">
    Suivant â–¶
  </button>
</div>
